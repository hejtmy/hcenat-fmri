---
title: "autocorrelation"
author: "Lukáš 'hejtmy' Hejtmánek"
date: "06/10/2020"
output: html_document
---

## Checking component correlation between participants

```{r, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

library(tidyverse)
library(corrplot)

DATA_DIR <- "E:/OneDrive/NUDZ/projects/HCENAT/Data/"
RELATIVE_DIR <- ".."

sapply(list.files("../functions", full.names = TRUE, recursive = TRUE), source)
COMPONENT_TYPE <- "filtered"
source("../scripts/load-data.R")
df_analysis <- df_fmri_all
```
### Single compoment visualisation

```{r}
out <- df_analysis %>%
  select(filt_component_33, participant, pulse_id) %>%
  pivot_wider(id_cols = c(pulse_id, participant), names_from = participant, 
              values_from = filt_component_33)
out_cor <- cor(out[, -1])
as.data.frame(out_cor) %>%
  rownames_to_column("participant") %>%
  pivot_longer(cols = -participant, names_to = "participant2") %>%
  ggplot(aes(participant, participant2, fill = value, alpha = value)) + 
  geom_tile() + labs(x = "", title = "Correlation of compoment 33 between subjects",
                     fill = "correlation", y = "") +
  guides(alpha = FALSE)
```

The average correlation of the component 33 between subjects was `r mean(out_cor[out_cor != 1])`.

```{r}
components <- colnames(df_analysis)
components <- components[grepl("component", components)]
df <- data.frame()
for(component in components){
  out <- df_analysis %>%
    select(any_of(component), participant, pulse_id) %>%
    pivot_wider(id_cols = c(pulse_id, participant), names_from = participant, 
                values_from = all_of(component))
  out_cor <- cor(out[, -1])
  avg <- mean(out_cor[out_cor != 1])
  avg_abs <- mean(abs(out_cor[out_cor != 1]))
  res <- list(component = component, avg_cor = avg, avg_abs_cor = avg_abs)
  df <- rbind(df, res)
}
```

```{r}
ggplot(df, aes(avg_cor)) + geom_histogram(binwidth = 0.01) + 
  labs(x = "Average correlation", 
       title = "Average correlations between subjects for all components")
```
```{r}
ggplot(df, aes(avg_abs_cor)) + geom_histogram(binwidth = 0.01) + 
  labs(x = "Average absolute correlation", 
       title = "Average absolute correlations between subjects for all components")
```

Overall, components do not seem to be correlated among each other between subjects, suggesting that they are paradigm driven.


## Correlation between the HRFs

```{r}
out <- df_hrfs %>%
  select(moving.learn, participant, pulse_id) %>%
  pivot_wider(id_cols = c(pulse_id, participant), names_from = participant, 
              values_from = moving.learn)
out_cor <- cor(out[, -1])
as.data.frame(out_cor) %>%
  rownames_to_column("participant") %>%
  pivot_longer(cols = -participant, names_to = "participant2") %>%
  ggplot(aes(participant, participant2, fill = value, alpha = value)) + 
  geom_tile() + labs(x = "", title = "Correlation of moving learn between subjects",
                     fill = "correlation", y = "") +
  guides(alpha = FALSE)
```

The average correlation of the learning movement between subjects was `r mean(out_cor[out_cor != 1])`.

```{r}
hrfs <- colnames(df_hrfs)[1:12]
df <- data.frame()
for(hrf in hrfs){
  print(hrf)
  out <- df_hrfs %>%
    select(any_of(hrf), participant, pulse_id) %>%
    pivot_wider(id_cols = c(pulse_id, participant),
                names_from = participant,
                values_from = all_of(hrf))
  out_cor <- cor(out[, -1])
  avg <- mean(out_cor[out_cor != 1])
  avg_abs <- mean(abs(out_cor[out_cor != 1]))
  res <- list(hrf = hrf, avg_cor = avg, avg_abs_cor = avg_abs)
  df <- rbind(df, res)
}

```

```{r}
ggplot(df, aes(avg_cor)) + geom_histogram(binwidth = 0.01) + 
  labs(x = "Average correlation", title = "Average correlations between subjects for all hrfs")
```

```{r}
ggplot(df, aes(avg_abs_cor)) + geom_histogram(binwidth = 0.01) + 
  labs(x = "Average absolute correlation", 
       title = "Average absolute correlations between subjects for all hrfs")
```