---
title: "Shifted-events"
author: "Lukáš 'hejtmy' Hejtmánek"
date: "14/10/2020"
output: html_document
---

```{r setup, include=FALSE, message=FALSE, warning=FALSE, results='hide'}
library(tidyverse)
DATA_DIR <- "E:/OneDrive/NUDZ/projects/HCENAT/Data/"
RELATIVE_DIR <- ".."
COMPONENT_TYPE <- "filtered"
source("../scripts/loading.R")
source_folder("../functions/")
source("../scripts/load-data.R", local = FALSE, )

knitr::opts_chunk$set(echo = TRUE)
```

## Analysis and checking of the shifted events
The goal of this sanity check is to see if the events predict the component even if their onsets are randomly shifted,

These analyses were done on the `~ 1 + moving.learn + moving.trial + pointing.learn + pointing.trial` first order model (each participant and component modeled independently) with autocorrelation. Events were loaded, randomly shifted using a random generator between -30 to +30s.

### Procedure
- load events
- randomly shift each start of the event by a number drawn from a uniform distribution of -30 to +30 s.
- save these events
- generate HRF for these shifted events
- recalculate the first order model
- save betas for each component / participant

```{r data-loading, echo = FALSE}
df_first_order_beta_shifted <- read.table("../summaries/first-order-beta-shifted.csv",
            sep = ";", header = TRUE) %>%
    select(term, estimate, participant, component) %>%
    pivot_wider(id_cols = c("participant", "component"), names_from = "term",
                values_from=estimate)

df_first_order_beta <- read.table("../summaries/first-order-beta.csv",
                                  header = TRUE, sep = ";") %>%
  select(term, estimate, participant, component) %>%
  pivot_wider(id_cols = c("participant", "component"), names_from = "term",
              values_from = estimate)

df_beta <- merge(df_first_order_beta, df_first_order_beta_shifted,
                 by = c("participant", "component"), suffixes = c("", "_shifted"))

rm(df_first_order_beta, df_first_order_beta_shifted)
```

### Correlations

We can look at how the betas correlate between the shifted vs non shifted.

```{r}
out_cor <- as.data.frame(cor(df_beta[,-c(1,2)])) %>%
  rownames_to_column("term") %>%
  filter(term != "(Intercept)", !grepl("shifted", term)) %>%
  select(term, ends_with("_shifted")) 
knitr::kable(out_cor, caption = "Correlation of betas")
```
